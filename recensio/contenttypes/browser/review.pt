<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="recensio">

  <metal:js fill-slot="javascript_head_slot">
    <script type="text/javascript">
      jq(document).ready(function(){
      $("#review-metadata").accordion({initShow : "ul.current"});
      $("a[rel=contactSheet]").fancybox({
      'transitionIn'      : 'elastic',
      'transitionOut'     : 'elastic',
      'titlePosition'     : 'over',
      'overlayOpacity'    :   0.7,
      'overlayColor'      :   '#000',
      'width'             : 850,
      'height'            : 1000,
      'titleFormat'       : function(title, currentArray, currentIndex, currentOpts) {
      return 'Image ' + (currentIndex + 1) + ' / ' + currentArray.length + (title.length ? '  ' + title : '') + '';
      }
      });
      });
    </script>

  </metal:js>
  <body>
    <div metal:fill-slot="content-title" tal:define="global sr python:True">
      <h2 tal:condition="python: context.portal_type == 'Presentation Online Resource'">
        <tal:title content="context/Title" />
      </h2>
      <h2 tal:condition="python: context.portal_type != 'Presentation Online Resource'">
        <tal:firstname content="context/getReviewAuthorLastname" />,
        <tal:lastname content="context/getReviewAuthorFirstname" />:
        <tal:title content="context/Title" />,
        <tal:title content="context/getSubtitle" />
      </h2>
    </div>
    
    
    <div metal:fill-slot="content-core">
      <div id="review"
           tal:define="searchresults context/getSearchresults | nothing;"
           >
        <p tal:condition="searchresults" tal:content="searchresults">
          Presentation Online Resources don't have this field
          
          [Infos aus dem „freien Feld“, das sich im Fall von
          Präsentationen automatisch aus den Metadaten befüllt
          (s. dazu am Ende der Metadaten)]
        </p>
        <ul id="pubSchwusch">
          <li>
            <h2 tal:content="context/Title"></h2>
            <p class="previews">
              <a rel="contactSheet" 
                 href="#" 
                 tal:attributes="href string:${here/absolute_url}/@@pageviewer; class string:iframe">
                <img src="get_page_image" 
                     tal:attributes="src string:${here/absolute_url}/get_page_image?no:int=1" 
                     i18n:attributes="alt review_page_1"
                     alt="Review page 1" 
                     class="page-1" />
                <img src="get_page_image" 
                     tal:condition="python:context.get_no_pages() >= 2" 
                     tal:attributes="src string:${here/absolute_url}/get_page_image?no:int=2" 
                     i18n:attributes="alt review_page_2"
                     alt="Review page 2" 
                     class="page-2" />
                <img src="get_page_image" 
                     tal:condition="python:context.get_no_pages() >= 3" 
                     tal:attributes="src string:${here/absolute_url}/get_page_image?no:int=3" 
                     i18n:attributes="alt review_page_3"
                     alt="Review page 3" 
                     class="page-3" />
              </a>
            </p>
            <h3 i18n:translate="about">
              About
            </h3>
            <dl>
              <dt i18n:translate="author">Author</dt>
              <dd><tal:b replace="context/getReviewAuthorFirstname" /> 
                <tal:b replace="context/getReviewAuthorLastname" /></dd>
              <dt tal:condition="context/getAuthors |nothing" i18n:translate="authors">Authors</dt>
              <dd tal:condition="context/getAuthors |nothing">
                <tal:r repeat="author context/getAuthors"> 
                  <tal:b replace="author/firstname" />
                  <tal:b replace="author/lastname" /><tal:c condition="not:repeat/author/end">,</tal:c> 
                </tal:r>
              </dd>
              <dt i18n:translate="uri">URI</dt>
              <dd><tal:b replace="context/getUri" /></dd>
              <dt i18n:translate="published">Published</dt>
              <dd><tal:b replace="context/getPlaceOfPublication | nothing" />, 
                <tal:b replace="context/getYearOfPublication | nothing" />
                <span i18n:translate="by">by</span> <tal:b replace="context/getPublisher | nothing" /></dd>
              <dt tal:condition="context/getIsbn |nothing">ISBN</dt>
              <dd tal:condition="context/getIsbn |nothing"><tal:b replace="context/getIsbn" /></dd>
              <dt tal:condition="context/getIssn |nothing">ISSN</dt>
              <dd tal:condition="context/getIssn |nothing"><tal:b replace="context/getIssn" /></dd>
              <dt tal:condition="context/getReferenceAuthors |nothing" i18n:translate="reference_authors">Reference Authors</dt>
              <dd tal:condition="context/getReferenceAuthors |nothing"><tal:b replace="context/getReferenceAuthors" /></dd>
            </dl>
          </li>
        </ul>
      </div>

      <div class="visualClear"><!-- --></div>
      <div id="review-citation" class="message notice">
        <h2 i18n:translate="citation_note">Zitierhinweise</h2>
        <p tal:content="structure context/get_citation_string"></p>
        <span i18n:translate="url">URL</span>:
        <a tal:attributes="href context/absolute_url"
           tal:content="context/absolute_url"></a>
      </div>

      <div id="review-license" class="message notice">
        <h2 i18n:translate="license-note-heading">Lizenzhinweis:</h2>
        <p i18n:translate="license-note">Dieser Beitrag unterliegt der Creative-Commons-Lizenz Namensnennung-Keine kommerzielle Nutzung-Keine Bearbeitung (CC-BY-NC-ND), darf also unter diesen Bedingungen elektronisch benutzt, übermittelt, ausgedruckt und zum Download bereitgestellt werden. Den Text der Lizenz erreichen Sie hier:</p>
        <a href="http://creativecommons.org/licenses/by-nc-nd/3.0/de">http://creativecommons.org/licenses/by-nc-nd/3.0/de</a>
      </div>


    </div>
    
    <metal:portlets fill-slot="portlets_two_slot" 
                    tal:define="pdf python:context.get_review_pdf()"
                    tal:condition="pdf">
      <div class="portlet" id="portletDownload"
           tal:define="pdf_ob python:pdf['blob']">
        <p class="download pdf"> 
          <a tal:attributes="href python:context.absolute_url()+'/@@generate-pdf-recension?language='+context.portal_languages.getPreferredLanguage()"
             href="PartB.pdf" 
             i18n:translate="download_as"
             >Download as <strong>PDF</strong><br />
            <em class="discrete">(<span tal:replace="python: pdf_ob and pdf['size']/1024 or 0" /> kb)</em></a> 
        </p> 
      </div>
      
      <div id="facebook-like"
           tal:define="url_quote_plus python:modules['Products.PythonScripts.standard'].url_quote_plus;
                       locale python:{'de':'de_DE', 'en':'en_GB', 'fr':'fr_FR'}[context.portal_languages.getPreferredLanguage()];
                       url python:'http://www.facebook.com/plugins/like.php?locale=' + locale + '&href=' + url_quote_plus(context.absolute_url()) + '&amp;layout=standard&amp;show_faces=false&amp;width=300&amp;action=like&amp;colorscheme=light&amp;height=35';">
        <iframe tal:attributes="src url; scrolling string:no; frameborder string:0; allowTransparency string:true"></iframe>
      </div>
      
      <div id="review-metadata" 
           tal:define="metadata_field_names context/metadata_fields;
                       metadata view/get_metadata">
        
        <h2 i18n:translate="metadata">Metadata</h2>

        <ul id="metadata_accordion" class="accordion">
          <li>
            <a class="trigger" style="display: block;" href="#" title="open/close" i18n:translate="metadata_publications">Publications</a>
            <ul>
              <li>
                <table>
                  <tbody>
                    <tal:field_names repeat="field_name metadata_field_names">
                      <tr tal:condition="python:metadata[field_name]['value']">
                        <th tal:content="python:metadata[field_name]['label']">
                          Editor (name or institution)</th>
                        
                        <td tal:condition="python:
                                           metadata[field_name]['is_macro']">
                          <metal:val 
                             use-macro="python:
                                        context.widget(field_name, mode='view')" 
                             />
                        </td>
                        <td tal:condition="python:
                                           not metadata[field_name]['is_macro']" 
                            tal:content="python:
                                         metadata[field_name]['value']">
                          Frank Severin
                        </td>

                      </tr>

                    </tal:field_names>
                  </tbody>
                </table>
              </li>
            </ul>
          </li>
        </ul>
      </div>
      
      
    </metal:portlets>
    
  </body>
</html>
