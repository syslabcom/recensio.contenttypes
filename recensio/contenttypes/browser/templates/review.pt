<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="en"
      metal:use-macro="here/main_template/macros/master"
      i18n:domain="recensio">

  <metal:js fill-slot="javascript_head_slot">
    <link rel="canonical" href="#" tal:condition="context/canonical_uri | nothing" tal:attributes="href context/canonical_uri" />
    <script type="text/javascript">
    jq(document).ready(function(){
        
        jq("#accordion-container").accordion({
            head     : "h2",
            el       : ".h",
            initShow : "li.opened-on-load"});

		jq('a[rel=contactSheet]').fancybox({
                type           : 'iframe',
                transitionIn   : 'elastic',
                transitionOut  : 'elastic',
                speedIn        : 800,
                speedOut       : 300,
                titlePosition  : 'over',
                overlayOpacity : 0.3,
                overlayColor   : '#000',
                width          : 850,
                height         : 1000,
                titleFormat    : function(title, currentArray, 
                                          currentIndex, currentOpts) {
                    return 'Image ' + (currentIndex + 1) + ' / ' + currentArray.length + (title.length ? '  ' + title : '') + '';
                }

            });
		    
        jq("a#toctrigger").fancybox({
            'hideOnContentClick': true
        });
        
    // add <a> tags to URLs
        urlpattern = "\\b((?:[a-z][\\w-]+:(?:/{1,3}|[a-z0-9%])|www\\d{0,3}[.]|[a-z0-9.\\-]+[.][a-z]{2,4}/)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:'\".,<>?«»“”‘’]))";
        jq("#mainContent").highlight(urlpattern);
    });
    </script>
  </metal:js>
  <body>

    <div metal:fill-slot="content-title" tal:define="global sr python:True">
      <h2 tal:content="context/getDecoratedTitle">username: Title</h2>
    </div>


    <div metal:fill-slot="content-core">
      <div id="review"
           tal:define="searchresults context/getSearchresults | nothing;"
           >
        <p tal:condition="searchresults" tal:content="searchresults">
          Presentation Online Resources don't have this field

          [Infos aus dem „freien Feld“, das sich im Fall von
          Präsentationen automatisch aus den Metadaten befüllt
          (s. dazu am Ende der Metadaten)]
        </p>

        <a rel="contactSheet" id="preview-image" href="#"
           tal:attributes="href string:${here/absolute_url}/@@pageviewer; class string:iframe"
           tal:define="no_pages context/get_no_pages">
          <img src="get_page_image"
               tal:attributes="src view/get_preview_img_url"/>
        </a>
        <p>
          <button onclick="window.location = '#commenting';"
                  value="Kommentieren"
                  i18n:translate="label_jump_to_add_comment">Kommentieren</button>
        </p>
        <p>
          <a tal:condition="python:getattr(context, 'tableOfContents', None)" id="toctrigger" href="#reviewtoc" i18n:translate="show_reviewtoc_trigger">Inhaltsverzeichnis anzeigen</a>
        </p>
        <div style="display:none"><pre id="reviewtoc" tal:condition="python:hasattr(context, 'tableOfContents')" tal:content="structure context/tableOfContents" /></div>

        <div id="reviewhtml" tal:content="structure context/review" />
      </div>

      <div class="visualClear"><!-- --></div>

      <iframe style="display: none"
              tal:condition="view/do_visit_canonical_uri"
              tal:attributes="src string:${context/canonical_uri}?recensio=true"></iframe>

      <div id="facebook-like"
           tal:define="url_quote_plus python:modules['Products.PythonScripts.standard'].url_quote_plus;
                       locale python:{'de':'de_DE', 'en':'en_GB', 'fr':'fr_FR'}[context.portal_languages.getPreferredLanguage()];
                       url python:'http://www.facebook.com/plugins/like.php?locale=' + locale + '&amp;href=' + url_quote_plus(context.absolute_url()) + '&amp;layout=button_count&amp;show_faces=false&amp;width=300&amp;action=like&amp;colorscheme=light&amp;height=35';">
        <iframe tal:attributes="src url; scrolling string:no; frameborder string:0; allowTransparency string:true"></iframe>
      </div>
      <div id="twitter-it">
        <a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
      </div>

    </div>

    <metal:portlets fill-slot="portlets_two_slot"
                    tal:define="pdf python:context.get_review_pdf()">
      <div class="portlet" id="portletDownload"
           tal:define="pdf_ob python:pdf and pdf['blob']"
           tal:condition="pdf">
        <p class="download pdf">
          <a tal:attributes="href python:context.absolute_url()+'/@@generate-pdf-recension?language='+context.portal_languages.getPreferredLanguage()"
             href="PartB.pdf"
             target="_blank"
             i18n:translate="download_as"
             >Download as <strong>PDF</strong><br />
          <em class="discrete">(<span i18n:name="download_size" tal:replace="python: pdf_ob and pdf['size']/1024 or 0" /> kb)</em></a>
        </p>
      </div>

      <div id="facebook-like"
           tal:define="url_quote_plus python:modules['Products.PythonScripts.standard'].url_quote_plus;
                       locale python:{'de':'de_DE', 'en':'en_GB', 'fr':'fr_FR'}[context.portal_languages.getPreferredLanguage()];
                       url python:'http://www.facebook.com/plugins/like.php?locale=' + locale + '&amp;href=' + url_quote_plus(context.absolute_url()) + '&amp;layout=button_count&amp;show_faces=false&amp;width=300&amp;action=like&amp;colorscheme=light&amp;height=35';">
        <iframe tal:attributes="src url; scrolling string:no; frameborder string:0; allowTransparency string:true"></iframe>
      </div>
      <div id="twitter-it">
        <a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
      </div>

      <div tal:define="metadata_field_names context/metadata_fields;
                       metadata view/get_metadata">
        <span class="Z3988" title="ctx_ver=Z39.88-2004"
              tal:attributes="title view/get_metadata_context_object" >


          <div id="accordion-container">
            <ul class="accordion">
              <li class="accordion-item">
                <h2 i18n:translate="metadata">Metadata</h2>

                <ul class="accordion-content">
                  <li class="opened-on-load">

                    <dl>
                      <tal:field_names repeat="field_name metadata_field_names">
                        <tal:has_value
                            condition="python:metadata[field_name]['value']">
                          <dt tal:content="python:metadata[field_name]['label']">
                          Editor (name or institution)</dt>

                          <dd tal:condition="python:
                                             metadata[field_name]['is_macro']">
                            <metal:val
                                use-macro="python:
                                           context.widget(field_name, mode='view')"
                                />
                          </dd>
                          <dd tal:condition="python:
                                             not metadata[field_name]['is_macro']"
                              tal:content="structure python:
                                           metadata[field_name]['value']">
                            Frank Severin
                          </dd>
                        </tal:has_value>
                      </tal:field_names>
                    </dl>

                  </li>
                </ul>
              </li>
              <li class="accordion-item">
                <h2 i18n:translate="citation_note">Zitierhinweise</h2>
                <ul class="accordion-content">
                  <li>
                    <p tal:content="structure context/get_citation_string"></p>
                    <dl>
                      <dt i18n:translate="url">URL:</dt>
                      <dd><a tal:attributes="href context/absolute_url"
                             tal:content="context/absolute_url"></a></dd>
                      <tal:canonical_uri define="url context/canonical_uri | nothing"
                                         condition="url">
                        <dt i18n:translate="heading_first_published">First published:</dt>
                        <dd><a tal:attributes="href url"
                               tal:content="url"></a>
                        </dd>
                      </tal:canonical_uri>
                    </dl>

                  </li>
                </ul>
              </li>
              <li class="accordion-item">
                <h2 i18n:translate="license-note-heading">Lizenzhinweis:</h2>
                <ul class="accordion-content">
                  <li>
                    <p tal:content="context/getLicense">Dieser Beitrag
                    unterliegt der Creative-Commons-Lizenz
                    Namensnennung-Keine kommerzielle Nutzung-Keine
                    Bearbeitung (CC-BY-NC-ND), darf also unter diesen
                    Bedingungen elektronisch benutzt, übermittelt,
                    ausgedruckt und zum Download bereitgestellt
                    werden. Den Text der Lizenz erreichen Sie hier:</p>
                    <a tal:condition="context/getLicenseURL | nothing"
                       tal:attributes="href python:
                                       context.getLicenseURL()['url']"
                       tal:content="python: context.getLicenseURL()['msg']">
                    Licence msg</a>
                  </li>
                </ul>
              </li>
              <li class="accordion-item"
                  tal:condition="python:context.Type().startswith('Presentation')">
                <h2 i18n:translate="links-box-heading">Links</h2>
                <ul class="accordion-content">
                  <li tal:define="online_review_urls view/get_online_review_urls;
                                  published_reviews view/get_published_reviews;
                                  user_home_page context/getReviewAuthorPersonalUrl;
                                  ">
                    <dl>
                      <dt tal:condition="context/uri" i18n:translate="online_accessible">
                        Diese Schrift ist online abrufbar
                      </dt>
                      <dd>
                        <a href="#"
                           tal:attributes="href context/uri"
                           tal:content="context/uri"></a>
                      </dd>
                      <dt tal:condition="not:context/uri" i18n:translate="online_not_accessible">Diese Schrift ist nicht online abrufbar</dt>
                      <dd />
                      <tal:block tal:condition="online_review_urls">
                        <dt i18n:translate="heading_online_reviews_of_presented_text">
                          Rezension/en zum praesentierten Werk
                        </dt>
                        <dd>
                          <span tal:repeat="online_review_url online_review_urls">
                            <a tal:attributes="href online_review_url/url"
                               tal:content="online_review_url/url">
                            </a>
                          </span>
                        </dd>
                      </tal:block>

                      <tal:block tal:condition="published_reviews">
                        <dt i18n:translate="heading_published_reviews_of_presented_text">
                          Published reviews of the presented text
                        </dt>
                        <dd tal:repeat="published_review published_reviews">
                          <span tal:replace="published_review/details">
                          </span>
                        </dd>
                      </tal:block>

                      <tal:block tal:condition="user_home_page">
                        <dt i18n:translate="">
                          Personal webpage URL/URN
                        </dt>
                        <dd>
                            <a tal:attributes="href user_home_page"
                               tal:content="user_home_page">
                            </a>
                        </dd>
                      </tal:block>
                    </dl>


                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </span>
      </div>

    </metal:portlets>

  </body>
</html>
